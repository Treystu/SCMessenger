<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCMessenger ¬∑ Join the Sovereign Mesh</title>
    <meta
      name="description"
      content="Sovereign encrypted messaging. No servers. No masters. Join the mesh."
    />
    <style>
      :root {
        --bg: #070b14;
        --bg-card: #0d1321;
        --bg-card-hover: #111827;
        --border: rgba(255, 255, 255, 0.06);
        --primary: #00ced1;
        --primary-dim: rgba(0, 206, 209, 0.12);
        --accent: #9d4edd;
        --accent-dim: rgba(157, 78, 221, 0.12);
        --success: #10b981;
        --warning: #f59e0b;
        --text: #e2e8f0;
        --text-muted: #94a3b8;
        --text-dim: #475569;
        --radius: 12px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
      }
      .mono {
        font-family:
          ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, Consolas,
          "DejaVu Sans Mono", monospace;
      }
      a {
        color: var(--primary);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }

      /* Mesh Background */
      .mesh-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        background:
          radial-gradient(
            ellipse at 20% 20%,
            rgba(0, 206, 209, 0.07),
            transparent 50%
          ),
          radial-gradient(
            ellipse at 80% 80%,
            rgba(157, 78, 221, 0.06),
            transparent 50%
          ),
          radial-gradient(
            ellipse at 50% 50%,
            rgba(0, 206, 209, 0.02),
            transparent 70%
          );
      }
      .mesh-bg::before {
        content: "";
        position: absolute;
        width: 2px;
        height: 2px;
        border-radius: 50%;
        top: 0;
        left: 0;
        box-shadow:
          120px 80px 0 rgba(0, 206, 209, 0.25),
          320px 160px 0 rgba(157, 78, 221, 0.2),
          550px 90px 0 rgba(0, 206, 209, 0.15),
          780px 200px 0 rgba(157, 78, 221, 0.18),
          200px 350px 0 rgba(0, 206, 209, 0.2),
          650px 400px 0 rgba(157, 78, 221, 0.15),
          900px 120px 0 rgba(0, 206, 209, 0.12),
          400px 500px 0 rgba(157, 78, 221, 0.2),
          100px 550px 0 rgba(0, 206, 209, 0.18),
          750px 550px 0 rgba(0, 206, 209, 0.15);
        animation: drift 40s linear infinite;
      }
      @keyframes drift {
        0% {
          transform: translate(0, 0);
        }
        50% {
          transform: translate(-30px, 20px);
        }
        100% {
          transform: translate(0, 0);
        }
      }

      .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 0 24px;
        position: relative;
        z-index: 1;
      }

      /* Header */
      header {
        padding: 20px 0;
        border-bottom: 1px solid var(--border);
      }
      .header-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .logo-group {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo-mark {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        display: grid;
        place-items: center;
        font-weight: 700;
        font-size: 14px;
        color: #070b14;
      }
      .logo-text {
        font-size: 1.15rem;
        font-weight: 600;
        letter-spacing: -0.02em;
      }

      /* Hero */
      .hero {
        padding: 80px 0 60px;
        text-align: center;
      }
      .hero h1 {
        font-size: clamp(2rem, 5vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.03em;
        background: linear-gradient(135deg, var(--text), var(--primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 16px;
      }
      .hero p {
        max-width: 560px;
        margin: 0 auto;
        color: var(--text-muted);
        font-size: 1.1rem;
      }

      /* Status Bar */
      .status-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
        padding: 20px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        margin-bottom: 60px;
      }
      .stat {
        text-align: center;
        min-width: 120px;
      }
      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
      }
      .stat-label {
        font-size: 0.75rem;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-top: 2px;
      }
      .stat-value.accent {
        color: var(--accent);
      }
      .pulse-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success);
        margin-right: 6px;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.6);
        }
        70% {
          opacity: 0.8;
          box-shadow: 0 0 0 6px rgba(16, 185, 129, 0);
        }
      }

      /* Section */
      .section {
        margin-bottom: 60px;
      }
      .section-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 24px;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Install Grid */
      .install-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
      }
      .install-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 24px;
        transition:
          border-color 0.2s,
          transform 0.2s;
      }
      .install-card:hover {
        border-color: rgba(0, 206, 209, 0.2);
        transform: translateY(-2px);
      }
      .install-card.recommended {
        border-color: rgba(0, 206, 209, 0.3);
        box-shadow: 0 0 20px rgba(0, 206, 209, 0.05);
      }
      .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      .card-icon {
        font-size: 1.5rem;
      }
      .badge {
        font-size: 0.65rem;
        padding: 3px 8px;
        border-radius: 99px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .badge-easy {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
      }
      .badge-medium {
        background: rgba(245, 158, 11, 0.15);
        color: var(--warning);
      }
      .badge-advanced {
        background: rgba(157, 78, 221, 0.15);
        color: var(--accent);
      }
      .badge-rec {
        background: var(--primary-dim);
        color: var(--primary);
        margin-left: 6px;
      }
      .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 4px;
      }
      .card-desc {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 12px;
      }
      .card-best {
        font-size: 0.75rem;
        color: var(--text-dim);
        margin-bottom: 16px;
      }
      .card-best strong {
        color: var(--text-muted);
      }

      .code-block {
        background: #0a0f1a;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px 14px;
        font-size: 0.8rem;
        overflow-x: auto;
        position: relative;
        margin-bottom: 12px;
      }
      .code-block code {
        color: var(--primary);
        white-space: pre-wrap;
        word-break: break-all;
      }
      .copy-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid var(--border);
        color: var(--text-muted);
        padding: 3px 8px;
        border-radius: 6px;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.15s;
      }
      .copy-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text);
      }

      .pros-cons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        font-size: 0.78rem;
        margin-top: 12px;
      }
      .pros-cons div {
        display: flex;
        align-items: flex-start;
        gap: 4px;
      }
      .pro {
        color: var(--success);
      }
      .con {
        color: var(--text-dim);
      }

      details {
        margin-top: 12px;
      }
      details summary {
        font-size: 0.8rem;
        color: var(--text-muted);
        cursor: pointer;
        user-select: none;
      }
      details summary:hover {
        color: var(--text);
      }
      details[open] summary {
        margin-bottom: 8px;
      }
      .steps {
        font-size: 0.82rem;
        color: var(--text-muted);
      }
      .steps ol {
        padding-left: 18px;
      }
      .steps li {
        margin-bottom: 6px;
      }

      /* Action Button */
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 18px;
        border-radius: 8px;
        border: none;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
      }
      .btn-primary {
        background: var(--primary);
        color: var(--bg);
      }
      .btn-primary:hover {
        filter: brightness(1.15);
        transform: translateY(-1px);
      }
      .btn-outline {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text-muted);
      }
      .btn-outline:hover {
        border-color: var(--primary);
        color: var(--primary);
      }
      .btn-sm {
        padding: 6px 12px;
        font-size: 0.78rem;
      }

      /* Peers Table */
      .peers-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
      }
      .peers-table th {
        text-align: left;
        padding: 8px 12px;
        color: var(--text-dim);
        font-weight: 500;
        border-bottom: 1px solid var(--border);
        text-transform: uppercase;
        font-size: 0.7rem;
        letter-spacing: 0.05em;
      }
      .peers-table td {
        padding: 8px 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        color: var(--text-muted);
      }
      .peers-table tr:hover td {
        background: rgba(255, 255, 255, 0.02);
      }
      .peer-status {
        display: inline-block;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        margin-right: 6px;
      }
      .peer-online {
        background: var(--success);
      }
      .peer-stale {
        background: var(--text-dim);
      }

      /* Principles */
      .principles {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }
      .principle {
        padding: 20px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
      }
      .principle-icon {
        font-size: 1.5rem;
        margin-bottom: 8px;
      }
      .principle h3 {
        font-size: 0.95rem;
        margin-bottom: 6px;
      }
      .principle p {
        font-size: 0.82rem;
        color: var(--text-muted);
      }

      /* Footer */
      footer {
        padding: 40px 0;
        text-align: center;
        border-top: 1px solid var(--border);
        color: var(--text-dim);
        font-size: 0.85rem;
        margin-top: 40px;
      }
      footer .tagline {
        font-size: 1rem;
        color: var(--text-muted);
        margin-bottom: 8px;
      }

      @media (max-width: 768px) {
        .hero {
          padding: 50px 0 40px;
        }
        .install-grid {
          grid-template-columns: 1fr;
        }
        .principles {
          grid-template-columns: 1fr;
        }
        .status-bar {
          flex-direction: column;
          align-items: center;
        }
        .pros-cons {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="mesh-bg"></div>

    <header>
      <div class="container header-inner">
        <div class="logo-group">
          <div class="logo-mark">SC</div>
          <span class="logo-text">SCMessenger</span>
        </div>
        <button
          class="btn btn-primary btn-sm"
          onclick="
            document
              .getElementById('install')
              .scrollIntoView({ behavior: 'smooth' })
          "
        >
          Join the Mesh
        </button>
      </div>
    </header>

    <div class="container">
      <!-- Hero -->
      <section class="hero">
        <h1>Your Device. Your Identity. Your Network.</h1>
        <p>
          SCMessenger is a sovereign encrypted mesh network. No servers control
          your messages. No companies hold your keys. Connect directly,
          peer&#8209;to&#8209;peer.
        </p>
      </section>

      <!-- Live Network Status -->
      <div class="status-bar" id="status-bar">
        <div class="stat">
          <div class="stat-value">
            <span class="pulse-dot" id="pulse"></span
            ><span id="s-peers">-</span>
          </div>
          <div class="stat-label">Connected Peers</div>
        </div>
        <div class="stat">
          <div class="stat-value accent" id="s-known">-</div>
          <div class="stat-label">Known Nodes</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="s-uptime" style="font-size: 1.1rem">
            -
          </div>
          <div class="stat-label">Node Uptime</div>
        </div>
        <div class="stat">
          <div
            class="stat-value mono"
            id="s-peerid"
            style="font-size: 0.75rem; word-break: break-all; max-width: 180px"
          >
            -
          </div>
          <div class="stat-label">This Node</div>
        </div>
      </div>

      <!-- Install Options -->
      <section class="section" id="install">
        <div class="section-title">‚ö° Join the Mesh</div>

        <div class="install-grid">
          <!-- Docker -->
          <div class="install-card recommended">
            <div class="card-header">
              <span class="card-icon">üê≥</span>
              <div>
                <span class="badge badge-easy">Easy</span>
                <span class="badge badge-rec">Recommended</span>
              </div>
            </div>
            <div class="card-title">Run a Node (Docker)</div>
            <div class="card-desc">
              One command. Runs as a persistent relay that strengthens the mesh
              for everyone.
            </div>
            <div class="card-best">
              <strong>Best for:</strong> Servers, always-on machines, VPS
            </div>
            <div class="code-block">
              <!-- One-liner for easy copy-paste -->
              <code id="docker-cmd"
                >docker run -d --restart always --name scmessenger -p 9000:9000
                -p 9001:9001 testbotz/scmessenger:latest</code
              >
              <button class="copy-btn" onclick="copyCode('docker-cmd', this)">
                Copy
              </button>
            </div>
            <details>
              <summary>Setup steps &amp; details</summary>
              <div class="steps">
                <ol>
                  <li>
                    Install
                    <a
                      href="https://docs.docker.com/get-docker/"
                      target="_blank"
                      >Docker</a
                    >
                  </li>
                  <li>Run the command above</li>
                  <li>
                    Your node auto-discovers the mesh via built-in bootstrap
                    nodes
                  </li>
                  <li>
                    Optional: add <code>Watchtower</code> for auto-updates
                  </li>
                </ol>
              </div>
            </details>
            <div class="pros-cons">
              <div class="pro">‚úì Easiest setup</div>
              <div class="con">‚úó Requires Docker</div>
              <div class="pro">‚úì Auto-restarts</div>
              <div class="con">‚úó Slight overhead</div>
            </div>
          </div>

          <!-- Native Binary -->
          <div class="install-card">
            <div class="card-header">
              <span class="card-icon">üì¶</span>
              <span class="badge badge-medium">Fast</span>
            </div>
            <div class="card-title">Native Binary</div>
            <div class="card-desc">
              Download the standalone executable. No containers, no
              dependencies. Maximum performance.
            </div>
            <div class="card-best">
              <strong>Best for:</strong> Linux servers, power users
            </div>

            <div style="text-align: center; margin: 16px 0">
              <a
                href="/api/download/scm-linux-amd64"
                class="btn btn-outline btn-sm"
                style="width: 100%; justify-content: center"
              >
                ‚Üì Download Linux (x64)
              </a>
              <p
                style="
                  font-size: 0.75rem;
                  color: var(--text-dim);
                  margin-top: 8px;
                "
              >
                macOS & Windows binaries coming soon. Use Docker or build from
                source.
              </p>
            </div>

            <div class="code-block">
              <code id="binary-setup"
                >chmod +x scm-linux-amd64 mv scm-linux-amd64 scm ./scm
                start</code
              >
              <button class="copy-btn" onclick="copyCode('binary-setup', this)">
                Copy
              </button>
            </div>

            <div class="pros-cons">
              <div class="pro">‚úì Native performance</div>
              <div class="con">‚úó Manual updates</div>
              <div class="pro">‚úì Single binary</div>
              <div class="con">‚úó Platform specific</div>
            </div>
          </div>

          <!-- Join (Auto-Config) -->
          <div class="install-card">
            <div class="card-header">
              <span class="card-icon">‚ö°</span>
              <span class="badge badge-medium">Fast</span>
            </div>
            <div class="card-title">Quick Connect (Auto-Config)</div>
            <div class="card-desc">
              Already have the <code>scm</code> binary? Configure it to join
              this specific mesh instantly.
            </div>
            <div class="card-best">
              <strong>Best for:</strong> Quickly joining a new mesh from CLI
            </div>
            <div class="code-block">
              <code id="bundle-cmd"
                >curl -sL http://localhost:9000/api/install | bash</code
              >
              <button class="copy-btn" onclick="copyCode('bundle-cmd', this)">
                Copy
              </button>
            </div>
            <details style="margin-top: 12px">
              <summary>What this script does</summary>
              <div class="steps">
                <ol>
                  <li>
                    Backs up your existing <code>config.json</code> (if any)
                  </li>
                  <li>Writes a new config with this mesh's bootstrap nodes</li>
                  <li>Verifies your configuration directory</li>
                  <li>Tells you how to start the node</li>
                </ol>
                <p
                  style="
                    margin-top: 8px;
                    font-size: 0.78rem;
                    color: var(--text-dim);
                  "
                >
                  Inspect the script first if you prefer:
                  <a
                    href="/api/install"
                    target="_blank"
                    style="color: var(--primary)"
                    >view script</a
                  >.
                </p>
              </div>
            </details>
            <div class="pros-cons">
              <div class="pro">‚úì Automated setup</div>
              <div class="con">‚úó Requires scm binary</div>
              <div class="pro">‚úì Instant join</div>
              <div class="con">‚úó Overwrites config</div>
            </div>
            <div style="margin-top: 12px; text-align: center">
              <button
                class="btn btn-outline btn-sm"
                onclick="downloadBundle()"
                id="bundle-btn"
              >
                Manual JSON Download
              </button>
            </div>
          </div>

          <!-- Source -->
          <div class="install-card">
            <div class="card-header">
              <span class="card-icon">üîß</span>
              <span class="badge badge-advanced">Advanced</span>
            </div>
            <div class="card-title">Build It Yourself (Source)</div>
            <div class="card-desc">
              Clone the repo and compile. Verify every line. Maximum sovereignty
              and trust.
            </div>
            <div class="card-best">
              <strong>Best for:</strong> Developers, security auditors,
              contributors
            </div>
            <div class="code-block">
              <code id="source-cmd"
                >git clone https://github.com/Treystu/SCMessenger.git && cd
                SCMessenger && cargo run --bin scmessenger-cli -- start</code
              >
              <button class="copy-btn" onclick="copyCode('source-cmd', this)">
                Copy
              </button>
            </div>
            <div class="pros-cons">
              <div class="pro">‚úì Full code audit</div>
              <div class="con">‚úó Requires Rust toolchain</div>
              <div class="pro">‚úì Maximum trust</div>
              <div class="con">‚úó Longer setup</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Identity Notice -->
      <section class="section">
        <div
          style="
            background: var(--accent-dim);
            border: 1px solid rgba(157, 78, 221, 0.2);
            border-radius: var(--radius);
            padding: 20px;
          "
        >
          <div style="font-size: 1rem; font-weight: 600; margin-bottom: 6px">
            üîë Your Identity is Yours Alone
          </div>
          <p style="font-size: 0.85rem; color: var(--text-muted)">
            When you run
            <code class="mono" style="color: var(--accent)">scm init</code>, an
            Ed25519 keypair is generated <strong>on your device</strong>. Your
            private key never leaves your machine. This node is a
            <em>mesh invitation</em>, not an identity provider. Every peer you
            connect to learns your public key through the P2P handshake ‚Äî no
            registration, no accounts, no servers.
          </p>
        </div>
      </section>

      <!-- Known Peers (Ledger) -->
      <section class="section" id="ledger-section">
        <div class="section-title">üìí Live Mesh Ledger</div>
        <p
          style="
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 16px;
          "
        >
          Every node's ledger is open and auditable. These are the peers this
          node knows about.
        </p>
        <div
          style="
            overflow-x: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
          "
        >
          <table class="peers-table" id="peers-table">
            <thead>
              <tr>
                <th>Address</th>
                <th>Peer ID</th>
                <th>Last Seen</th>
                <th>Type</th>
                <th>Topics</th>
              </tr>
            </thead>
            <tbody id="peers-tbody">
              <tr>
                <td
                  colspan="5"
                  style="
                    text-align: center;
                    padding: 20px;
                    color: var(--text-dim);
                  "
                >
                  Loading mesh data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Principles -->
      <section class="section">
        <div class="section-title">üåê Mesh Principles</div>
        <div class="principles">
          <div class="principle">
            <div class="principle-icon">üèõÔ∏è</div>
            <h3>Sovereignty</h3>
            <p>
              Your keys, your data, your device. No corporation sits between you
              and your communication. Identity is local-first.
            </p>
          </div>
          <div class="principle">
            <div class="principle-icon">üï∏Ô∏è</div>
            <h3>Full Mesh</h3>
            <p>
              Every node is a relay. Every device strengthens the network. There
              are no "special" servers ‚Äî just peers with varying resources.
            </p>
          </div>
          <div class="principle">
            <div class="principle-icon">ü§ù</div>
            <h3>Reciprocity</h3>
            <p>
              To message on the mesh, you must run a node. You give connectivity
              to receive connectivity. No free-riders by design.
            </p>
          </div>
        </div>
      </section>
    </div>

    <footer>
      <div class="container">
        <div class="tagline">Every node strengthens the mesh.</div>
        <div>
          SCMessenger ¬∑ Sovereign Communication ¬∑
          <a href="https://github.com/Treystu/SCMessenger">Source Code</a>
        </div>
      </div>
    </footer>

    <script>
      // === Network Info Fetch ===
      async function fetchInfo() {
        try {
          const r = await fetch("/api/network-info");
          if (!r.ok) throw new Error("not ok");
          const d = await r.json();
          updateStats(d);
          updateLedger(d.ledger || []);
        } catch (e) {
          document.getElementById("s-peers").textContent = "?";
          document.getElementById("s-known").textContent = "?";
          document.getElementById("s-uptime").textContent = "offline";
          document.getElementById("s-peerid").textContent = "unavailable";
        }
      }
      function updateStats(d) {
        const n = d.node || {};
        const net = d.network || {};
        document.getElementById("s-peers").textContent =
          net.connected_peers ?? "-";
        document.getElementById("s-known").textContent = net.known_peers ?? "-";
        document.getElementById("s-uptime").textContent = fmtUptime(
          n.uptime_seconds || 0,
        );
        const pid = n.peer_id || "";
        document.getElementById("s-peerid").textContent =
          pid.length > 20 ? pid.slice(0, 8) + "‚Ä¶" + pid.slice(-6) : pid;
        document.getElementById("s-peerid").title = pid;
      }
      function fmtUptime(s) {
        if (s < 60) return s + "s";
        if (s < 3600) return Math.floor(s / 60) + "m";
        const h = Math.floor(s / 3600),
          m = Math.floor((s % 3600) / 60);
        return h + "h " + m + "m";
      }
      function updateLedger(entries) {
        const tb = document.getElementById("peers-tbody");
        if (!entries.length) {
          tb.innerHTML =
            '<tr><td colspan="5" style="text-align:center;padding:20px;color:var(--text-dim)">No peers in ledger yet</td></tr>';
          return;
        }
        tb.innerHTML = entries
          .map((e) => {
            const age = Math.floor(Date.now() / 1000) - (e.last_seen || 0);
            const fresh = age < 600;
            const ago =
              age < 60
                ? "just now"
                : age < 3600
                  ? Math.floor(age / 60) + "m ago"
                  : age < 86400
                    ? Math.floor(age / 3600) + "h ago"
                    : Math.floor(age / 86400) + "d ago";
            const pid = e.last_peer_id || "‚Äî";
            const pidShort =
              pid.length > 16 ? pid.slice(0, 8) + "‚Ä¶" + pid.slice(-4) : pid;
            return (
              "<tr>" +
              '<td class="mono" style="font-size:0.75rem">' +
              esc(e.address || e.multiaddr) +
              "</td>" +
              '<td class="mono" style="font-size:0.72rem" title="' +
              esc(pid) +
              '">' +
              esc(pidShort) +
              "</td>" +
              '<td><span class="peer-status ' +
              (fresh ? "peer-online" : "peer-stale") +
              '"></span>' +
              ago +
              "</td>" +
              "<td>" +
              (e.is_bootstrap
                ? '<span style="color:var(--primary)">bootstrap</span>'
                : "discovered") +
              "</td>" +
              '<td style="font-size:0.72rem">' +
              (e.known_topics || []).join(", ") +
              "</td>" +
              "</tr>"
            );
          })
          .join("");
      }
      function esc(s) {
        const d = document.createElement("div");
        d.textContent = s;
        return d.innerHTML;
      }

      // === Join Bundle Download ===
      async function downloadBundle() {
        const btn = document.getElementById("bundle-btn");
        btn.textContent = "Generating...";
        try {
          const r = await fetch("/api/join-bundle");
          const d = await r.json();
          const blob = new Blob([JSON.stringify(d, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "scm-join-bundle.json";
          a.click();
          URL.revokeObjectURL(url);
          btn.textContent = "‚úì Downloaded!";
          setTimeout(() => (btn.textContent = "‚Üì Download Join Bundle"), 2000);
        } catch (e) {
          btn.textContent = "Error ‚Äî try again";
          setTimeout(() => (btn.textContent = "‚Üì Download Join Bundle"), 2000);
        }
      }

      // === Copy to Clipboard ===
      function copyCode(id, btn) {
        const el = id
          ? document.getElementById(id)
          : btn.previousElementSibling;
        const text = el ? el.textContent : "";
        navigator.clipboard.writeText(text).then(() => {
          btn.textContent = "Copied!";
          setTimeout(() => (btn.textContent = "Copy"), 1500);
        });
      }

      // === Platform Detection ===
      (function detectPlatform() {
        const ua = navigator.userAgent.toLowerCase();
        let platform = "unknown";
        if (ua.includes("mac")) platform = "macos";
        else if (ua.includes("linux")) platform = "linux";
        else if (ua.includes("win")) platform = "windows";
        else if (ua.includes("android")) platform = "android";
        else if (ua.includes("iphone") || ua.includes("ipad")) platform = "ios";
        // Could highlight recommended option per platform in future
      })();

      // === Init ===
      fetchInfo();
      setInterval(fetchInfo, 10000);

      // Update curl command with current host
      const host = window.location.host;
      document.getElementById("bundle-cmd").innerText =
        `curl -sL http://${host}/api/install | bash`;
    </script>
  </body>
</html>
